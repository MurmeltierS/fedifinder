<!-- This is a static file -->
<!-- served from your routes in server.js -->

<!DOCTYPE html>
<html>
  <head>
    <title>Fedifinder</title>
    <meta
      name="description"
      content="Fediverse accounts of your Twitter followings"
    />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="/js/json2csv.js" type="text/javascript"></script>
    <script src="/js/tinytest.js" type="text/javascript"></script>
    <script src="/js/vue.dev.js" type="text/javascript"></script>
    <script src="/js/font-awesome.min.js" type="text/javascript"></script>
    <script src="/client.js" type="text/javascript" defer></script>
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="stylesheet" type="text/css" href="/css/bulma.min.css" />
  </head>
  <body class="has-navbar-fixed-top" id="fedifinder">
    <nav
      class="navbar is-fixed-top"
      role="navigation"
      aria-label="main navigation"
    >
      <div class="navbar-brand">
        <div class="navbar-item">
          <a class="title" href="https://fedifinder.glitch.me/"
            >Fedifinder<br />
            <h3 class="subtitle is-4">Join the Fediverse in 5 easy steps</h3>
          </a>
        </div>
      </div>

      <div class="navbar-menu">
        <div v-if="twitter_auth" class="navbar-end">
          <div class="navbar-item">
            <div class="buttons">
              <button @click="logoff" class="button is-danger is-light">
                <strong>Logout</strong>
              </button>
              <a
                target="_blank"
                href="https://twitter.com/settings/connected_apps"
                class="button is-danger is-outlined"
              >
                <strong>Revoke Permissions</strong>
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div
      v-if="twitter_auth"
      class="section buttons is-flex-touch is-hidden-desktop"
    >
      <button @click="logoff()" class="button is-danger is-light">
        <strong>Logout</strong>
      </button>
      <a
        target="_blank"
        href="https://twitter.com/settings/connected_apps"
        class="button is-danger is-outlined"
      >
        <strong>Revoke Permissions</strong>
      </a>
    </div>

    <div>
      <section class="section">
        <h2 class="title is-4">
          1. Find an instance
          <span v-if="twitter_auth" class="icon has-text-success">
            <i class="fas fa-check"></i>
          </span>
        </h2>
        <h3 v-if="!twitter_auth" class="subtitle is-5">
          <div class="level">
            <div class="level-left">
              <div class="level-item">
                <a href="/Auth/twitter" class="button is-info">
                  <span class="icon">
                    <i class="fab fa-twitter"></i>
                  </span>
                  <strong class="has-text-white">Authorize Twitter</strong>
                </a>
              </div>
              <div class="level-item">
                to see on which instances your Twitter contacts are.
              </div>
            </div>
          </div>
        </h3>
        <h3 v-else class="subtitle is-5">
          Your Twitter contacts are on these instances.
        </h3>
        <div v-if="domains && Object.keys(domains).length > 0">
          <ul>
            <li v-for="[domain, data] of Object.entries(domains)">
              <span
                v-if="data['openRegistrations'] === 1 && data['part_of_fediverse'] === 1"
              >
                <a class="title is-5" :href="`https://${domain}`">{{domain}}</a>
                {{data.software_name}} {{data.software_version}},
                {{data.users_total}} users, {{data.handles.length}} of your
                contacts
                <span v-if="data['openRegistrations'] == 1"
                  ><strong>registration open</strong></span
                ><span v-else>registration closed</span></span
              >
            </li>
            <li v-for="[domain, data] of Object.entries(domains)">
              <span
                v-if="data['openRegistrations'] === 0 && data['part_of_fediverse'] === 1"
              >
                <a class="title is-5" :href="`https://${domain}`">{{domain}}</a>
                {{data.software_name}} {{data.software_version}},
                {{data.users_total}} users, {{data.handles.length}} of your
                contacts
                <span v-if="data['openRegistrations'] == 1"
                  ><strong>registration open</strong></span
                ><span v-else>registration closed</span></span
              >
            </li>
          </ul>
        </div>
      </section>

      <section class="section">
        <h2 class="title is-4">
          2. Publish your handle
          <span
            v-if="profile && accounts[profile.username]['handles'].length > 0"
            class="icon has-text-success"
          >
            <i class="fas fa-check"></i>
          </span>
          <span v-else class="icon has-text-danger">
            <i class="fas fa-xmark"></i>
          </span>
        </h2>
        <h3 class="subtitle is-5">
          Sign up for a Fediverse account and add the handle to your Twitter
          profile (description, location, url or pinned Tweet).
        </h3>
        <div v-if="profile">
          <div v-if="(accounts[profile.username]['handles'].length > 0)">
            <p>
              These handles were found in your profile @{{profile.username}}.
            </p>
            <div
              v-for="handle in accounts[profile.username]['handles']"
              class="level"
            >
              <div class="level-left">
                <div class="level-item">
                  <strong class="card-footer-item">{{handle}}</strong>
                </div>
                <div class="level-item">
                  After exporting, you can import the CSV file at&nbsp;
                  <a href="{{handle.split('@')[2]+'/settings/import'}}">
                    {{handle.split("@")[2]+"/settings/import"}}</a
                  >
                </div>
              </div>
            </div>
          </div>
          <div v-else>
            <p>
              No handles were found on your profile @{{profile.username}}.
              Please use the format @name@host.tld or https://host.tld/@name. If
              you added it after authorizing Fedifinder,
              <a href="/ActualAuth/twitter" class="is-info is-small">
                <strong>rescan your profile</strong> </a
              >.
            </p>
          </div>
        </div>
      </section>

      <section class="section">
        <h2 class="title is-4">3. Scan your network</h2>
        <h3 class="subtitle is-5">
          In addition to the accounts you follow, you can scan lists and
          followers.
        </h3>

        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <div class="field has-addons">
                <div class="control has-icons-left">
                  <div class="select">
                    <select name="list">
                      <option value="vis">vis</option>
                      <option value="Bolivia">Bolivia</option>
                      <option value="Brazil">Brazil</option>
                      <option value="Chile">Chile</option>
                      <option value="Colombia">Colombia</option>
                      <option value="Ecuador">Ecuador</option>
                      <option value="Guyana">Guyana</option>
                      <option value="Paraguay">Paraguay</option>
                      <option value="Peru">Peru</option>
                      <option value="Suriname">Suriname</option>
                      <option value="Uruguay">Uruguay</option>
                      <option value="Venezuela">Venezuela</option>
                    </select>
                  </div>
                  <div class="icon is-small is-left">
                    <i class="fas fa-list"></i>
                  </div>
                </div>
                <div class="control">
                  <button type="submit" class="button is-success">
                    <span class="icon">
                      <i class="fa fa-users-viewfinder"></i>
                    </span>
                    <span>Scan list</span>
                  </button>
                </div>
                <div class="control">
                  <button type="submit" class="button is-black is-outlined">
                    <span class="icon">
                      <i class="fas fa-xmark"></i>
                    </span>
                    <span>Skip list</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="level-item">
              <button class="button is-success is-outlined">
                <span class="icon">
                  <i class="fa fa-users-viewfinder"></i> </span
                ><span>Scan Followers</span>
              </button>
            </div>
          </div>
        </div>
        <div class="content">
          <p>
            {{scan_count}} accounts scanned <br />
            {{unqiue_count}} unique handles from working fediverse domains
            found<br />
            {{followed_count}} accounts are already being followed by you
            (experimental feature)
            <br />
            {{broken_count}} handles from other services (eg. mail) or
            unresponsive servers
            <br />{{unchecked_domains_count}} domains are still being checked
            Retry
          </p>
          <progress class="progress is-info" value="45" max="100">45%</progress>
        </div>
      </section>

      <section class="section">
        <h2 class="title is-4">4. Export your network</h2>
        <h3 class="subtitle is-5">Get all the handles in one CSV file</h3>
        <button class="button is-success">
          <span class="icon">
            <i class="fas fa-file-export"></i>
          </span>
          <span>Export CSV with found handles</span>
        </button>
      </section>

      <section class="section">
        <h2 class="title is-4">5. Import your network</h2>
        <h3 class="subtitle is-5">
          Go to the settings of your Fediverse account and import your whole
          network at once.
        </h3>

        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <strong class="card-footer-item">@luca@vis.social</strong>
            </div>
            <div class="level-item"><a href="#">Open import settings</a></div>
          </div>
        </div>
        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <strong class="card-footer-item">@luca@det.social</strong>
            </div>
            <div class="level-item"><a href="#">Open import settings</a></div>
          </div>
        </div>
      </section>

      <section class="section">
        <h2 class="title is-4">Your network in the Fediverse</h2>
        <h3 class="subtitle is-5">
          Here are the found handles sorted by their instance.
        </h3>
        <h4 class="title is-5">social.luca.run</h4>
        <h5 class="subtitle is-6">
          mastodon 4.0.2, <strong>registration open</strong>
        </h5>
        <div class="content">
          <ol>
            <li>
              <div class="level">
                <div class="level-left">
                  <div class="level-item">
                    <a href="#">@luca@social.luca.run</a> (<a href=""></a>@Luca)
                  </div>
                  <div class="level-item">
                    <button class="button is-link is-small">
                      Follow @luca from @luca@social.luca.run
                    </button>
                  </div>
                </div>
              </div>
            </li>
          </ol>
        </div>
      </section>

      <section class="section">
        <h2 class="title is-4">Bonus: Backup all accounts</h2>
        <h3 class="subtitle is-5">
          You can download a CSV or JSON with information about all the scanned
          accounts. Including those that haven't joined the Fediverse yet.
        </h3>
        <div class="level">
          <div class="level-left">
            <div class="level-item">
              <button class="button is-success">
                <span class="icon">
                  <i class="fas fa-file-export"></i>
                </span>
                <span>Export CSV with all accounts</span>
              </button>
            </div>
            <div class="level-item">
              <button class="button is-success">
                <span class="icon">
                  <i class="fas fa-file-export"></i>
                </span>
                <span>Export JSON with all accounts</span>
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer class="footer">
      <div class="content has-text-centered">
        <p>
          <strong>Fedifinder</strong> by
          <a href="https://vis.social/@luca">@luca@vis.social</a>. The source
          code is licensed
          <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. You
          can create your own version by remixing it on
          <a href="https://glitch.com/edit/#!/fedifinder">Glitch</a> or
          <a href="https://github.com/lucahammer/fedifinder">Github</a>.
        </p>
      </div>
    </footer>
  </body>
</html>
